<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Scaling Databases with Proxy Servers | Ashish Rathod</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://arathod02.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://arathod02.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://arathod02.github.io/docs/blog/proxy-server"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Scaling Databases with Proxy Servers | Ashish Rathod"><meta data-rh="true" name="description" content="In the complex landscape of distributed systems, direct communication between clients and backend resources is often inefficient or insecure. Enter the Proxy Server—an intermediary that sits between the end-user clients and the resources they intend to browse or access."><meta data-rh="true" property="og:description" content="In the complex landscape of distributed systems, direct communication between clients and backend resources is often inefficient or insecure. Enter the Proxy Server—an intermediary that sits between the end-user clients and the resources they intend to browse or access."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-12-25T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://www.linkedin.com/in/ashish-rathod02/"><link data-rh="true" rel="icon" href="/docs/img/favicon.jpg"><link data-rh="true" rel="canonical" href="https://arathod02.github.io/docs/blog/proxy-server"><link data-rh="true" rel="alternate" href="https://arathod02.github.io/docs/blog/proxy-server" hreflang="en"><link data-rh="true" rel="alternate" href="https://arathod02.github.io/docs/blog/proxy-server" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://arathod02.github.io/docs/blog/proxy-server","mainEntityOfPage":"https://arathod02.github.io/docs/blog/proxy-server","url":"https://arathod02.github.io/docs/blog/proxy-server","headline":"Scaling Databases with Proxy Servers","name":"Scaling Databases with Proxy Servers","description":"In the complex landscape of distributed systems, direct communication between clients and backend resources is often inefficient or insecure. Enter the Proxy Server—an intermediary that sits between the end-user clients and the resources they intend to browse or access.","datePublished":"2025-12-25T00:00:00.000Z","author":{"@type":"Person","name":"Ashish Rathod","description":"Ex-Intuit Staff Engineer","url":"https://www.linkedin.com/in/ashish-rathod02/","image":"https://github.com/arathod02.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://arathod02.github.io/docs/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="Ashish Rathod RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="Ashish Rathod Atom Feed"><link rel="stylesheet" href="/docs/assets/css/styles.815ca38a.css">
<script src="/docs/assets/js/runtime~main.de293555.js" defer="defer"></script>
<script src="/docs/assets/js/main.4026af67.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/favicon.jpg"><link rel="preload" as="image" href="https://github.com/arathod02.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/favicon.jpg" alt="Ashish Rathod Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/favicon.jpg" alt="Ashish Rathod Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Ashish Rathod</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/db-pessimistic-optimistic-locking">Scalable Distributed Key-Value Store</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/db-pessimistic-optimistic-locking">Deep Dive into Database Pessimistic &amp; Optimistic Locking</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/docs/blog/proxy-server">Database Proxy Servers</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/server-sent-events-explained">Real-Time Communication with Server-Sent Events (SSE)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/application-level-sharding-design">Implementing Shard Aware Application</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/scaling-distributed-systems">Scaling Distributed Systems (Focus on Databases)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/avoid-hard-deletes">The Pains of Hard Delete</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/cache-stampede-thundering-herd">The Thundering Herd - Understanding and Solving the Cache Stampede</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/transformer-architecture">The Transformer Architecture</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/offline-online-indicator">Presence Service</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Scaling Databases with Proxy Servers</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-12-25T00:00:00.000Z">December 25, 2025</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/docs/blog/authors/ashish"><img class="avatar__photo authorImage_XqGP" src="https://github.com/arathod02.png" alt="Ashish Rathod"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/docs/blog/authors/ashish"><span class="authorName_yefp" translate="no">Ashish Rathod</span></a></div><small class="authorTitle_nd0D" title="Ex-Intuit Staff Engineer">Ex-Intuit Staff Engineer</small><div class="authorSocials_rSDt"><a href="https://www.linkedin.com/in/ashish-rathod02/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" style="--dark:#0a66c2;--light:#ffffffe6" class="authorSocialIcon_XYv3 linkedinSvg_FCgI"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453"></path></svg></a><a href="https://github.com/arathod02" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>In the complex landscape of distributed systems, direct communication between clients and backend resources is often inefficient or insecure. Enter the <strong>Proxy Server</strong>—an intermediary that sits between the end-user clients and the resources they intend to browse or access.</p>
<p>In the context of database architecture, a database proxy abstracts the underlying database topology from the application layer. Instead of applications connecting directly to a specific database instance (like a primary or a replica), they connect to the proxy, which then intelligently routes the query to the appropriate destination.</p>
<p>Popular examples in the relational database world include <strong>PgBouncer</strong> for PostgreSQL, which excels at connection pooling, and <strong>ProxySQL</strong> or <strong>MaxScale</strong> for MySQL, which provide advanced features like query routing, caching, and failover management.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="benefits-of-using-a-proxy-server">Benefits of Using a Proxy Server<a href="#benefits-of-using-a-proxy-server" class="hash-link" aria-label="Direct link to Benefits of Using a Proxy Server" title="Direct link to Benefits of Using a Proxy Server" translate="no">​</a></h2>
<p>Implementing a proxy server in your database architecture offers several robust advantages:</p>
<ul>
<li class="">
<p><strong>Connection Pooling and Multiplexing</strong>
Opening and closing database connections is an expensive operation. Proxies maintain a pool of open connections to the backend databases and reuse them for multiple client requests (multiplexing). This drastically reduces the connection overhead on the database server, allowing it to dedicate more resources to executing queries rather than managing network handshakes.</p>
</li>
<li class="">
<p><strong>Load Balancing and Read/Write Splitting</strong>
Proxies can distribute incoming traffic across multiple database nodes. By identifying the type of query (e.g., specific <code>SELECT</code> statements versus <code>INSERT</code>/<code>UPDATE</code>s), the proxy can automatically route write operations to the primary node and read operations to read replicas. This ensures optimal resource utilization and prevents a single node from becoming a bottleneck.</p>
</li>
<li class="">
<p><strong>High Availability and Failover</strong>
A proxy creates an abstraction layer that insulates the application from database failures. If a database node goes down, the proxy detects the failure and immediately stops sending traffic to that node, rerouting it to healthy instances. This failover happens transparently to the application, which continues to communicate with the proxy without realizing the backend topology has changed.</p>
</li>
<li class="">
<p><strong>Query Caching</strong>
Some advanced proxies can cache the results of frequently executed queries in their own memory. If a client requests data that is already cached, the proxy serves the result instantly without ever hitting the backend database. This significantly reduces latency for the application and lowers the load on the database server.</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="deep-dive-proxysql-for-mysql">Deep Dive: ProxySQL for MySQL<a href="#deep-dive-proxysql-for-mysql" class="hash-link" aria-label="Direct link to Deep Dive: ProxySQL for MySQL" title="Direct link to Deep Dive: ProxySQL for MySQL" translate="no">​</a></h2>
<p>ProxySQL is a high-performance, open-source proxy for MySQL (and forks like Percona Server and MariaDB). It is uniquely designed to solve the challenges of high-traffic, highly available database clusters. Unlike simple connection poolers, ProxySQL understands the SQL protocol, allowing it to inspect queries and make intelligent routing decisions based on the actual SQL content, user, or schema.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-scenario-elastic-scaling-for-burst-traffic">The Scenario: Elastic Scaling for Burst Traffic<a href="#the-scenario-elastic-scaling-for-burst-traffic" class="hash-link" aria-label="Direct link to The Scenario: Elastic Scaling for Burst Traffic" title="Direct link to The Scenario: Elastic Scaling for Burst Traffic" translate="no">​</a></h3>
<p>Let&#x27;s weave our exploration around a specific, common business scenario:</p>
<blockquote>
<p><strong>The Use Case:</strong> Imagine an e-commerce platform that experiences a massive surge in traffic only during &quot;Flash Sales&quot; (e.g., 6 PM to 8 PM). During these hours, read traffic spikes by 10x.</p>
<p><strong>The Strategy:</strong> To handle this cost-effectively, we want an <strong>elastic database topology</strong>. We will spin up additional Read Replicas specifically for the flash sale window and tear them down afterward.</p>
<p><strong>The Challenge:</strong> We need to add and remove these database nodes dynamically <em>without</em> changing application code, <em>without</em> redeploying the app, and <em>without</em> any downtime.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-mysql-to-distribute-and-divert-traffic">Using MySQL to Distribute and Divert Traffic<a href="#using-mysql-to-distribute-and-divert-traffic" class="hash-link" aria-label="Direct link to Using MySQL to Distribute and Divert Traffic" title="Direct link to Using MySQL to Distribute and Divert Traffic" translate="no">​</a></h2>
<p>ProxySQL manages backend servers using <strong>Hostgroups</strong>. A hostgroup is simply a logical grouping of database servers (e.g., Hostgroup 10 for Writers, Hostgroup 20 for Readers).</p>
<p>Let&#x27;s walk through the configuration steps to achieve our elastic routing.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="a-configuring-backend-servers">a) Configuring Backend Servers<a href="#a-configuring-backend-servers" class="hash-link" aria-label="Direct link to a) Configuring Backend Servers" title="Direct link to a) Configuring Backend Servers" translate="no">​</a></h3>
<p>First, we define our backend servers in the <code>mysql_servers</code> table.</p>
<ul>
<li class=""><strong>Hostgroup 10:</strong> The Primary Writer (High consistency).</li>
<li class=""><strong>Hostgroup 20:</strong> The Permanent Readers.</li>
<li class=""><strong>Hostgroup 30:</strong> The &quot;Flash Sale&quot; Elastic Readers (only active during surges).</li>
</ul>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Connect to ProxySQL Admin interface (usually port 6032)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Insert the Writer (Primary)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> mysql_servers </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hostgroup_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;db-primary&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3306</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Insert the Permanent Reader</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> mysql_servers </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hostgroup_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;db-reader-permanent&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3306</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Insert the Elastic Readers (initially can be offline or added dynamically)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> mysql_servers </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hostgroup_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;db-reader-elastic-1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3306</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="b-significance-of-load-mysql-servers">b) Significance of LOAD MYSQL SERVERS<a href="#b-significance-of-load-mysql-servers" class="hash-link" aria-label="Direct link to b) Significance of LOAD MYSQL SERVERS" title="Direct link to b) Significance of LOAD MYSQL SERVERS" translate="no">​</a></h3>
<p>When you run the <code>INSERT</code> commands above, you are modifying the configuration in <strong>Memory</strong> (specifically, the <code>main</code> database in memory). These changes are not yet effective for live traffic.</p>
<p>To apply these changes to the runtime engine (the part of ProxySQL actually handling traffic), you must run:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">LOAD</span><span class="token plain"> MYSQL SERVERS </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> RUNTIME</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>This command acts as a &quot;commit&quot; to the running process. It tells ProxySQL to start using the new server list immediately without restarting the service.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="c-significance-of-save-mysql-servers">c) Significance of SAVE MYSQL SERVERS<a href="#c-significance-of-save-mysql-servers" class="hash-link" aria-label="Direct link to c) Significance of SAVE MYSQL SERVERS" title="Direct link to c) Significance of SAVE MYSQL SERVERS" translate="no">​</a></h3>
<p>While <code>LOAD</code> pushes changes to runtime, it does not persist them to disk. If ProxySQL restarts, all changes in memory are lost. To ensure your configuration survives a reboot, you must save them to the internal SQLite database file on disk:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SAVE</span><span class="token plain"> MYSQL SERVERS </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISK</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="d-adding-more-replicas-scaling-out">d) Adding More Replicas (Scaling Out)<a href="#d-adding-more-replicas-scaling-out" class="hash-link" aria-label="Direct link to d) Adding More Replicas (Scaling Out)" title="Direct link to d) Adding More Replicas (Scaling Out)" translate="no">​</a></h3>
<p>When the &quot;Flash Sale&quot; begins, your orchestration tool (like Terraform or Kubernetes) provisions new DB replicas. To register them with ProxySQL:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Adding new elastic nodes for the surge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> mysql_servers </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hostgroup_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;db-reader-elastic-2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3306</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> mysql_servers </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hostgroup_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;db-reader-elastic-3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3306</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Apply changes instantly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LOAD</span><span class="token plain"> MYSQL SERVERS </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> RUNTIME</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SAVE</span><span class="token plain"> MYSQL SERVERS </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISK</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><em>The application knows nothing about these new IPs; it just continues talking to ProxySQL.</em></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="e-significance-of-mysql_query_rules">e) Significance of mysql_query_rules<a href="#e-significance-of-mysql_query_rules" class="hash-link" aria-label="Direct link to e) Significance of mysql_query_rules" title="Direct link to e) Significance of mysql_query_rules" translate="no">​</a></h3>
<p>The real magic happens in the <code>mysql_query_rules</code> table. This acts as a firewall and router combined. You define rules that match specific criteria (regex on the query, username, schema name, etc.) and assign an action, such as assigning a <code>destination_hostgroup</code>.</p>
<p>ProxySQL evaluates rules in order of their <code>rule_id</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="f-routing-based-on-query-type-readwrite-split">f) Routing Based on Query Type (Read/Write Split)<a href="#f-routing-based-on-query-type-readwrite-split" class="hash-link" aria-label="Direct link to f) Routing Based on Query Type (Read/Write Split)" title="Direct link to f) Routing Based on Query Type (Read/Write Split)" translate="no">​</a></h3>
<p>A classic rule is to send all <code>SELECT</code> queries to the reader groups (Hostgroup 20 and 30) and everything else to the writer (Hostgroup 10).</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Rule: Direct all SELECT statements to Hostgroup 20 (Readers)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> mysql_query_rules </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rule_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> match_digest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> destination_hostgroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">apply</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                 </span><span class="token comment" style="color:#999988;font-style:italic">-- rule_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">-- active</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;^SELECT.*&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">-- match_digest (Regex for queries starting with SELECT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">-- destination_hostgroup (Permanent Readers)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">-- apply (Stop processing further rules if this matches)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LOAD</span><span class="token plain"> MYSQL QUERY RULES </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> RUNTIME</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SAVE</span><span class="token plain"> MYSQL QUERY RULES </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISK</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><em>Note: In production, you might set up a &quot;Replication Lag&quot; check so ProxySQL doesn&#x27;t send queries to readers that are too far behind the writer.</em></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="g-routing-based-on-schema-analytics-vs-transactions">g) Routing Based on Schema (Analytics vs. Transactions)<a href="#g-routing-based-on-schema-analytics-vs-transactions" class="hash-link" aria-label="Direct link to g) Routing Based on Schema (Analytics vs. Transactions)" title="Direct link to g) Routing Based on Schema (Analytics vs. Transactions)" translate="no">​</a></h3>
<p>Suppose you have a specific schema <code>analytics_db</code> that runs heavy aggregation queries. You don&#x27;t want these blocking your transactional users. You can route traffic hitting this specific schema to the elastic hostgroup (Hostgroup 30).</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Rule: Direct traffic for schema &#x27;analytics_db&#x27; to Hostgroup 30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> mysql_query_rules </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rule_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> schemaname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> destination_hostgroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">apply</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">-- Lower ID = Higher Priority than the generic SELECT rule</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;analytics_db&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">-- Exact match on schema name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">-- Elastic/Analytics Readers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LOAD</span><span class="token plain"> MYSQL QUERY RULES </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> RUNTIME</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SAVE</span><span class="token plain"> MYSQL QUERY RULES </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISK</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="h-commenthint-based-routing">h) Comment/Hint Based Routing<a href="#h-commenthint-based-routing" class="hash-link" aria-label="Direct link to h) Comment/Hint Based Routing" title="Direct link to h) Comment/Hint Based Routing" translate="no">​</a></h3>
<p>Sometimes regex isn&#x27;t enough. You might have a critical <code>SELECT</code> statement (e.g., checking inventory before checkout) that <em>must</em> go to the Writer (Hostgroup 10) to ensure strong consistency, bypassing the replica entirely.</p>
<p>Developers can inject a SQL comment (hint) into the query, and ProxySQL can route based on that comment.</p>
<p><strong>Example Query from Application:</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* forceful_write */</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> quantity </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> products </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">101</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>ProxySQL Rule:</strong></p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Rule: If query contains &quot;forceful_write&quot;, send to Writer (HG 10)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> mysql_query_rules </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rule_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> match_digest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> destination_hostgroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">apply</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">-- Highest Priority</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;forceful_write&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- Regex matching the comment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">-- Writer Hostgroup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LOAD</span><span class="token plain"> MYSQL QUERY RULES </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> RUNTIME</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SAVE</span><span class="token plain"> MYSQL QUERY RULES </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISK</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>This gives developers granular control over routing without hardcoding IP addresses in the application.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="deployment-of-proxysql">Deployment of ProxySQL<a href="#deployment-of-proxysql" class="hash-link" aria-label="Direct link to Deployment of ProxySQL" title="Direct link to Deployment of ProxySQL" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-fleet-of-proxysql-fronted-by-a-load-balancer">1. Fleet of ProxySQL Fronted by a Load Balancer<a href="#1-fleet-of-proxysql-fronted-by-a-load-balancer" class="hash-link" aria-label="Direct link to 1. Fleet of ProxySQL Fronted by a Load Balancer" title="Direct link to 1. Fleet of ProxySQL Fronted by a Load Balancer" translate="no">​</a></h3>
<p>In this topology, you run multiple independent ProxySQL instances behind a classic Load Balancer (like AWS NLB or HAProxy).</p>
<!-- -->
<ul>
<li class=""><strong>Advantages:</strong>
<ul>
<li class=""><strong>Simple to understand:</strong> Each ProxySQL node is independent.</li>
<li class=""><strong>High Availability:</strong> If one ProxySQL node dies, the Load Balancer removes it.</li>
</ul>
</li>
<li class=""><strong>Disadvantages:</strong>
<ul>
<li class=""><strong>Configuration Drift:</strong> If you add a new query rule to <code>ProxySQL A</code>, you must manually apply the exact same SQL commands to <code>ProxySQL B</code> and <code>C</code>. Automation tools (Ansible/Chef) are required to keep them in sync.</li>
<li class=""><strong>Split Brain Risks:</strong> If configurations diverge, users might get different results depending on which proxy the Load Balancer hits.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-proxysql-cluster-mode-native-clustering">2. ProxySQL Cluster Mode (Native Clustering)<a href="#2-proxysql-cluster-mode-native-clustering" class="hash-link" aria-label="Direct link to 2. ProxySQL Cluster Mode (Native Clustering)" title="Direct link to 2. ProxySQL Cluster Mode (Native Clustering)" translate="no">​</a></h3>
<p>ProxySQL supports native clustering. You configure the instances to form a cluster, and they automatically synchronize their configuration.</p>
<!-- -->
<ul>
<li class=""><strong>Advantages:</strong>
<ul>
<li class=""><strong>Auto-Synchronization:</strong> You only need to run the <code>INSERT</code> and <code>LOAD</code> commands on <em>one</em> node. The changes are automatically propagated to all other nodes in the cluster.</li>
<li class=""><strong>Management Ease:</strong> Drastically reduces the operational overhead of managing a large fleet.</li>
</ul>
</li>
<li class=""><strong>Disadvantages:</strong>
<ul>
<li class=""><strong>Complexity:</strong> Setting up the internal cluster network requires careful configuration.</li>
<li class=""><strong>Network Overhead:</strong> There is a small amount of traffic between proxies for synchronization.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="elastic-topology-visualization">Elastic Topology Visualization<a href="#elastic-topology-visualization" class="hash-link" aria-label="Direct link to Elastic Topology Visualization" title="Direct link to Elastic Topology Visualization" translate="no">​</a></h2>
<p>Here is how our Elastic/Flash Sale setup looks. The application connects to ProxySQL, which handles the dynamic routing to the elastic fleet.</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="aws-aurora-alternative-custom-endpoints">AWS Aurora Alternative: Custom Endpoints<a href="#aws-aurora-alternative-custom-endpoints" class="hash-link" aria-label="Direct link to AWS Aurora Alternative: Custom Endpoints" title="Direct link to AWS Aurora Alternative: Custom Endpoints" translate="no">​</a></h2>
<p>If you are hosted specifically on AWS Aurora, you might not always need an external layer like ProxySQL for basic traffic segregation. Aurora offers a native feature called <strong>Custom Endpoints</strong>.</p>
<p>In the AWS Aurora ecosystem, <strong>Custom Endpoints</strong> offer a native alternative to external proxies for routing traffic to specific groups of database instances. Unlike the standard Cluster Reader Endpoint which cycles through <em>all</em> available replicas, a Custom Endpoint allows you to arbitrarily group specific instances—such as high-performance nodes—into a distinct VIP. When an application connects to this custom DNS name, Aurora performs DNS-based load balancing to distribute connections across only the pre-selected instances in that group. This feature is ideal for isolating workloads; for example, you can direct heavy analytical reports to a specific set of larger instances while keeping fast transactional reads on smaller instances for the web application. Because it operates at the DNS level, it provides instance-level isolation but lacks the granular query-level routing rules (regex parsing) found in tools like ProxySQL. It simplifies infrastructure management by removing the need for an intermediate proxy layer when simple instance grouping satisfies the routing requirements.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="visualizing-aurora-custom-endpoints">Visualizing Aurora Custom Endpoints<a href="#visualizing-aurora-custom-endpoints" class="hash-link" aria-label="Direct link to Visualizing Aurora Custom Endpoints" title="Direct link to Visualizing Aurora Custom Endpoints" translate="no">​</a></h3>
<p>The following diagram illustrates how a Custom Endpoint acts as a specific entry point, load balancing traffic across a dedicated subset of readers, separate from the general traffic.</p>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h3>
<p>By leveraging ProxySQL, we effectively decoupled our application from the database infrastructure. We achieved the ability to &quot;burst&quot; our read capacity by adding elastic nodes (Hostgroup 30) and routing heavy traffic to them via <code>mysql_query_rules</code>. All of this happened transparently to the application, ensuring high availability and cost efficiency during peak business hours.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/proxy-server.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/blog/db-pessimistic-optimistic-locking"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Deep Dive into Database Pessimistic &amp; Optimistic Locking</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/blog/server-sent-events-explained"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Real-Time Communication with Server-Sent Events (SSE)</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#benefits-of-using-a-proxy-server" class="table-of-contents__link toc-highlight">Benefits of Using a Proxy Server</a></li><li><a href="#deep-dive-proxysql-for-mysql" class="table-of-contents__link toc-highlight">Deep Dive: ProxySQL for MySQL</a><ul><li><a href="#the-scenario-elastic-scaling-for-burst-traffic" class="table-of-contents__link toc-highlight">The Scenario: Elastic Scaling for Burst Traffic</a></li></ul></li><li><a href="#using-mysql-to-distribute-and-divert-traffic" class="table-of-contents__link toc-highlight">Using MySQL to Distribute and Divert Traffic</a><ul><li><a href="#a-configuring-backend-servers" class="table-of-contents__link toc-highlight">a) Configuring Backend Servers</a></li><li><a href="#b-significance-of-load-mysql-servers" class="table-of-contents__link toc-highlight">b) Significance of LOAD MYSQL SERVERS</a></li><li><a href="#c-significance-of-save-mysql-servers" class="table-of-contents__link toc-highlight">c) Significance of SAVE MYSQL SERVERS</a></li><li><a href="#d-adding-more-replicas-scaling-out" class="table-of-contents__link toc-highlight">d) Adding More Replicas (Scaling Out)</a></li><li><a href="#e-significance-of-mysql_query_rules" class="table-of-contents__link toc-highlight">e) Significance of mysql_query_rules</a></li><li><a href="#f-routing-based-on-query-type-readwrite-split" class="table-of-contents__link toc-highlight">f) Routing Based on Query Type (Read/Write Split)</a></li><li><a href="#g-routing-based-on-schema-analytics-vs-transactions" class="table-of-contents__link toc-highlight">g) Routing Based on Schema (Analytics vs. Transactions)</a></li><li><a href="#h-commenthint-based-routing" class="table-of-contents__link toc-highlight">h) Comment/Hint Based Routing</a></li></ul></li><li><a href="#deployment-of-proxysql" class="table-of-contents__link toc-highlight">Deployment of ProxySQL</a><ul><li><a href="#1-fleet-of-proxysql-fronted-by-a-load-balancer" class="table-of-contents__link toc-highlight">1. Fleet of ProxySQL Fronted by a Load Balancer</a></li><li><a href="#2-proxysql-cluster-mode-native-clustering" class="table-of-contents__link toc-highlight">2. ProxySQL Cluster Mode (Native Clustering)</a></li></ul></li><li><a href="#elastic-topology-visualization" class="table-of-contents__link toc-highlight">Elastic Topology Visualization</a></li><li><a href="#aws-aurora-alternative-custom-endpoints" class="table-of-contents__link toc-highlight">AWS Aurora Alternative: Custom Endpoints</a><ul><li><a href="#visualizing-aurora-custom-endpoints" class="table-of-contents__link toc-highlight">Visualizing Aurora Custom Endpoints</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"></div></footer></div>
</body>
</html>