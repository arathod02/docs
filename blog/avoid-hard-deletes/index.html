<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">A Deep Dive into Database Storage Engines and Soft Deletion Strategies. | Ashish Rathod</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://arathod02.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://arathod02.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://arathod02.github.io/docs/blog/avoid-hard-deletes"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="A Deep Dive into Database Storage Engines and Soft Deletion Strategies. | Ashish Rathod"><meta data-rh="true" name="description" content="A Deep Dive into Database Storage Engines and Soft Deletion Strategies."><meta data-rh="true" property="og:description" content="A Deep Dive into Database Storage Engines and Soft Deletion Strategies."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-12-11T12:26:27.000Z"><meta data-rh="true" property="article:author" content="https://www.linkedin.com/in/ashish-rathod02/"><link data-rh="true" rel="icon" href="/docs/img/favicon.jpg"><link data-rh="true" rel="canonical" href="https://arathod02.github.io/docs/blog/avoid-hard-deletes"><link data-rh="true" rel="alternate" href="https://arathod02.github.io/docs/blog/avoid-hard-deletes" hreflang="en"><link data-rh="true" rel="alternate" href="https://arathod02.github.io/docs/blog/avoid-hard-deletes" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://arathod02.github.io/docs/blog/avoid-hard-deletes","mainEntityOfPage":"https://arathod02.github.io/docs/blog/avoid-hard-deletes","url":"https://arathod02.github.io/docs/blog/avoid-hard-deletes","headline":"A Deep Dive into Database Storage Engines and Soft Deletion Strategies.","name":"A Deep Dive into Database Storage Engines and Soft Deletion Strategies.","description":"A Deep Dive into Database Storage Engines and Soft Deletion Strategies.","datePublished":"2025-12-11T12:26:27.000Z","author":{"@type":"Person","name":"Ashish Rathod","description":"Ex-Intuit Staff Engineer","url":"https://www.linkedin.com/in/ashish-rathod02/","image":"https://github.com/arathod02.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://arathod02.github.io/docs/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="Ashish Rathod RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="Ashish Rathod Atom Feed"><link rel="stylesheet" href="/docs/assets/css/styles.815ca38a.css">
<script src="/docs/assets/js/runtime~main.046fe0f2.js" defer="defer"></script>
<script src="/docs/assets/js/main.431311ba.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/img/favicon.jpg"><link rel="preload" as="image" href="https://github.com/arathod02.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/favicon.jpg" alt="Ashish Rathod Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/favicon.jpg" alt="Ashish Rathod Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Ashish Rathod</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/proxy-server">Proxy Servers &amp; ProxySQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/server-sent-events-explained">Real-Time Communication with Server-Sent Events (SSE)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/application-level-sharding-design">Implementing Shard Aware Application</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/scaling-distributed-systems">Scaling Distributed Systems (Focus on Databases)</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/docs/blog/avoid-hard-deletes">The Pains of Hard Delete</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/cache-stampede-thundering-herd">The Thundering Herd - Understanding and Solving the Cache Stampede</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/transformer-architecture">The Transformer Architecture</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/blog/offline-online-indicator">Presence Service</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">A Deep Dive into Database Storage Engines and Soft Deletion Strategies.</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-12-11T12:26:27.000Z">December 11, 2025</time> · <!-- -->19 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/docs/blog/authors/ashish"><img class="avatar__photo authorImage_XqGP" src="https://github.com/arathod02.png" alt="Ashish Rathod"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/docs/blog/authors/ashish"><span class="authorName_yefp" translate="no">Ashish Rathod</span></a></div><small class="authorTitle_nd0D" title="Ex-Intuit Staff Engineer">Ex-Intuit Staff Engineer</small><div class="authorSocials_rSDt"><a href="https://www.linkedin.com/in/ashish-rathod02/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" style="--dark:#0a66c2;--light:#ffffffe6" class="authorSocialIcon_XYv3 linkedinSvg_FCgI"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453"></path></svg></a><a href="https://github.com/arathod02" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h2>
<p>In the discipline of database architecture, the mechanism of deletion is frequently underestimated. While the creation and retrieval of data receive significant attention regarding optimization and structure, the removal of data—specifically the &quot;Hard Delete&quot;—is often treated as a trivial housekeeping operation. However, an exhaustive analysis of storage engine internals reveals that hard deletion is one of the most resource-intensive and structurally disruptive operations in a relational database management system (RDBMS).</p>
<p>This report provides a comprehensive technical analysis of the storage engines underpinning major databases, specifically MySQL&#x27;s InnoDB and PostgreSQL&#x27;s Heap architecture. It articulates the high costs associated with physical record removal, including B+ Tree rebalancing, locking contention, input/output (I/O) thrashing, and vacuum-induced bloat. Consequently, this document advocates for a &quot;Soft Delete by Design&quot; methodology, treating deletion as a logical state transition rather than a physical storage event. It concludes with a robust lifecycle management strategy that couples logical soft deletion with asynchronous, batched hard deletion to maintain long-term storage hygiene without compromising system stability.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-storage-engine-internals">1. Storage Engine Internals<a href="#1-storage-engine-internals" class="hash-link" aria-label="Direct link to 1. Storage Engine Internals" title="Direct link to 1. Storage Engine Internals" translate="no">​</a></h2>
<p>To comprehend the catastrophic potential of a hard delete, one must first possess a nuanced understanding of how data resides on the disk. The abstraction of a &quot;table&quot; composed of &quot;rows&quot; and &quot;columns&quot; is a logical convenience; the physical reality is a complex arrangement of binary pages, pointers, and trees.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="11-mysql-innodb-the-index-organized-table"><strong>1.1 MySQL InnoDB: The Index-Organized Table</strong><a href="#11-mysql-innodb-the-index-organized-table" class="hash-link" aria-label="Direct link to 11-mysql-innodb-the-index-organized-table" title="Direct link to 11-mysql-innodb-the-index-organized-table" translate="no">​</a></h3>
<p>In the MySQL ecosystem, the default storage engine is InnoDB. Its defining characteristic is that it does not merely use an index to find data; the table <em>is</em> the index. This architecture is known as a Clustered Index, implemented via a B+ Tree data structure.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="111-the-b-tree-hierarchythe-lifecycle-strategy"><strong>1.1.1 The B+ Tree Hierarchy</strong>The Lifecycle Strategy<a href="#111-the-b-tree-hierarchythe-lifecycle-strategy" class="hash-link" aria-label="Direct link to 111-the-b-tree-hierarchythe-lifecycle-strategy" title="Direct link to 111-the-b-tree-hierarchythe-lifecycle-strategy" translate="no">​</a></h4>
<p>The B+ Tree is a self-balancing tree structure designed to maintain sorted data and allow searches, sequential access, insertions, and deletions in logarithmic time. It is distinct from a binary tree in its high fan-out; a single node can have hundreds of children, allowing the tree to remain incredibly shallow (usually 3 to 4 levels deep) even for tables containing billions of rows.</p>
<ul>
<li class=""><strong>The Root Page:</strong> The entry point of the tree. It resides at a fixed location and contains pointers to internal nodes.</li>
<li class=""><strong>Internal Nodes (Non-Leaf):</strong> These nodes act as the navigational roadmap. They contain only the Primary Key values and pointers to child pages. Because they do not store the full row data, they are lightweight. A single 16KB page can store hundreds of keys, maximizing the &quot;fan-out&quot; capability and ensuring that traversing the tree requires minimal disk I/O.</li>
<li class=""><strong>Leaf Nodes (The Data):</strong> This is where the physical reality of the Clustered Index becomes apparent. The leaf nodes contain the actual row data—every column of every record.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="112-primary-key-ordering-in-leaf-nodes"><strong>1.1.2 Primary Key Ordering in Leaf Nodes</strong><a href="#112-primary-key-ordering-in-leaf-nodes" class="hash-link" aria-label="Direct link to 112-primary-key-ordering-in-leaf-nodes" title="Direct link to 112-primary-key-ordering-in-leaf-nodes" translate="no">​</a></h4>
<p>A critical architectural feature of InnoDB is that the leaf nodes are strictly ordered by the Primary Key. This is not a suggestion; it is a physical enforcement. If a table has a Primary Key of ID, the row with ID=1 is physically stored adjacent to ID=2 within the 16KB page.</p>
<p>Furthermore, these leaf nodes are strictly linked in a doubly linked list. Each leaf page contains a pointer to the previous page and the next page. This structure enables the database to perform extremely fast range scans (e.g., SELECT * FROM orders WHERE id BETWEEN 100 AND 200) by traversing the linked list rather than returning to the root node.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="113-page-filling-and-fragmentation"><strong>1.1.3 Page Filling and Fragmentation</strong><a href="#113-page-filling-and-fragmentation" class="hash-link" aria-label="Direct link to 113-page-filling-and-fragmentation" title="Direct link to 113-page-filling-and-fragmentation" translate="no">​</a></h4>
<p>InnoDB manages storage in units called Pages, typically 16KB in size. When records are inserted sequentially (e.g., using an auto-incrementing integer), InnoDB fills these pages efficiently, leaving only a small fraction (typically 1/16th) free for future modifications. This results in a &quot;Fill Factor&quot; of nearly 100%, ensuring optimal disk usage and cache efficiency.</p>
<p>However, when data is modified or deleted, this order is disturbed. A hard delete creates a physical &quot;hole&quot; in the page. If enough holes are created, the page density drops, leading to fragmentation—a state where the database engine is caching and reading pages that are largely empty air.</p>
<p><strong>Table 1: B+ Tree Node Characteristics</strong></p>
<table><thead><tr><th style="text-align:left">Node Type</th><th style="text-align:left">Content</th><th style="text-align:left">Purpose</th><th style="text-align:left">Density</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Internal Node</strong></td><td style="text-align:left">Primary Keys + Child Pointers</td><td style="text-align:left">Navigation</td><td style="text-align:left">High (Keys only)</td></tr><tr><td style="text-align:left"><strong>Leaf Node</strong></td><td style="text-align:left">Full Row Data</td><td style="text-align:left">Storage</td><td style="text-align:left">Variable (Depends on Row Size)</td></tr><tr><td style="text-align:left"><strong>Leaf Linkage</strong></td><td style="text-align:left">Double Pointers (Prev/Next)</td><td style="text-align:left">Range Scans</td><td style="text-align:left">N/A</td></tr></tbody></table>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="12-postgresql-the-heap-and-tuple-architecture"><strong>1.2 PostgreSQL: The Heap and Tuple Architecture</strong><a href="#12-postgresql-the-heap-and-tuple-architecture" class="hash-link" aria-label="Direct link to 12-postgresql-the-heap-and-tuple-architecture" title="Direct link to 12-postgresql-the-heap-and-tuple-architecture" translate="no">​</a></h3>
<p>PostgreSQL employs a fundamentally different storage paradigm known as the Heap. Unlike InnoDB, where the table is the index, PostgreSQL separates the table storage (the Heap) from the index storage.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="121-heap-pages-and-item-pointers"><strong>1.2.1 Heap Pages and Item Pointers</strong><a href="#121-heap-pages-and-item-pointers" class="hash-link" aria-label="Direct link to 121-heap-pages-and-item-pointers" title="Direct link to 121-heap-pages-and-item-pointers" translate="no">​</a></h4>
<p>In PostgreSQL, data is stored in a file known as the &quot;Heap.&quot; This file is divided into fixed-length blocks, typically 8KB. Within these blocks, records (referred to as &quot;tuples&quot;) are stored in an unordered fashion. A tuple is inserted into the first page that has sufficient free space, regardless of its Primary Key value.</p>
<p>This lack of inherent order necessitates a mechanism to locate data. PostgreSQL uses the Tuple Identifier (TID), often referred to as ctid. The ctid is a coordinate pair: (Block Number, Offset Number). For example, (42, 7) means the 7th item on the 42nd page.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="122-the-array-of-line-pointers"><strong>1.2.2 The Array of Line Pointers</strong><a href="#122-the-array-of-line-pointers" class="hash-link" aria-label="Direct link to 122-the-array-of-line-pointers" title="Direct link to 122-the-array-of-line-pointers" translate="no">​</a></h4>
<p>To manage the internal organization of an 8KB page, PostgreSQL uses an array of &quot;Line Pointers&quot; (ItemIds) at the beginning of the page header.</p>
<ul>
<li class=""><strong>Indirection:</strong> The ctid actually points to a Line Pointer, not the tuple itself. The Line Pointer then points to the byte offset where the tuple begins within the page.</li>
<li class=""><strong>Why Indirection Matters:</strong> This allows the database to defragment the page internally (move tuples around to close gaps) without changing the ctid or updating external indexes. As long as the Line Pointer at index 7 remains, the tuple can be anywhere in the page.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="123-ordered-indexes-vs-unordered-heap"><strong>1.2.3 Ordered Indexes vs. Unordered Heap</strong><a href="#123-ordered-indexes-vs-unordered-heap" class="hash-link" aria-label="Direct link to 123-ordered-indexes-vs-unordered-heap" title="Direct link to 123-ordered-indexes-vs-unordered-heap" translate="no">​</a></h4>
<p>It is a common misconception that PostgreSQL tables are ordered by Primary Key. They are not. The Heap is unordered.8 However, the <strong>Primary Key Index</strong> is a B-Tree structure that <em>is</em> strictly ordered. This index stores the Primary Key value and the corresponding ctid of the heap tuple. When a query requests a row by ID, the engine searches the ordered B-Tree Index, finds the ctid, and then retrieves the unordered tuple from the Heap.</p>
<p><strong>Table 2: Comparison of Storage Architectures</strong></p>
<table><thead><tr><th style="text-align:left">Feature</th><th style="text-align:left">MySQL InnoDB (B+ Tree)</th><th style="text-align:left">PostgreSQL (Heap)</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Organization</strong></td><td style="text-align:left">Clustered (Data is in the Index)</td><td style="text-align:left">Heap (Data is separate from Index)</td></tr><tr><td style="text-align:left"><strong>Ordering</strong></td><td style="text-align:left">Physically ordered by Primary Key</td><td style="text-align:left">Unordered (Insert order / Random)</td></tr><tr><td style="text-align:left"><strong>Row ID</strong></td><td style="text-align:left">Primary Key</td><td style="text-align:left">CTID (Block + Offset)</td></tr><tr><td style="text-align:left"><strong>Secondary Index</strong></td><td style="text-align:left">Points to Primary Key Value</td><td style="text-align:left">Points to CTID</td></tr><tr><td style="text-align:left"><strong>Page Size</strong></td><td style="text-align:left">16KB (Default)</td><td style="text-align:left">8KB (Default)</td></tr></tbody></table>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-the-pain-caused-by-hard-deletion">2. The pain caused by Hard Deletion<a href="#2-the-pain-caused-by-hard-deletion" class="hash-link" aria-label="Direct link to 2. The pain caused by Hard Deletion" title="Direct link to 2. The pain caused by Hard Deletion" translate="no">​</a></h2>
<p>With the storage context established, we can analyze the mechanics of the DELETE command. Far from a simple erasure, a hard delete triggers a complex sequence of internal operations that can destabilize the database.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="21-mysql-innodb-the-rebalancing-storm"><strong>2.1 MySQL InnoDB: The Rebalancing Storm</strong><a href="#21-mysql-innodb-the-rebalancing-storm" class="hash-link" aria-label="Direct link to 21-mysql-innodb-the-rebalancing-storm" title="Direct link to 21-mysql-innodb-the-rebalancing-storm" translate="no">​</a></h3>
<p>In a B+ Tree, structural integrity is paramount. The tree must remain balanced to ensure predictable performance. Deleting a row threatens this balance.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="211-the-search-and-destroy-mission"><strong>2.1.1 The Search and Destroy Mission</strong><a href="#211-the-search-and-destroy-mission" class="hash-link" aria-label="Direct link to 211-the-search-and-destroy-mission" title="Direct link to 211-the-search-and-destroy-mission" translate="no">​</a></h4>
<p>When a DELETE is issued, InnoDB must first traverse the tree to locate the leaf node containing the record. Once found, the record is not immediately wiped; it is &quot;delete-marked.&quot; This is a logical flag in the record header indicating the space is technically free but occupied by a &quot;ghost&quot;.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="212-the-merge-threshold"><strong>2.1.2 The Merge Threshold</strong><a href="#212-the-merge-threshold" class="hash-link" aria-label="Direct link to 212-the-merge-threshold" title="Direct link to 212-the-merge-threshold" translate="no">​</a></h4>
<p>The true cost arises when deletions accumulate. Each page has a MERGE_THRESHOLD, typically defaulting to 50%.</p>
<ol>
<li class=""><strong>Underflow:</strong> If a deletion causes the page&#x27;s data volume to drop below this threshold, InnoDB determines that the page is inefficient.</li>
<li class=""><strong>Locking:</strong> The engine places locks on the page and its neighbors (sibling nodes).</li>
<li class=""><strong>Merge Operation:</strong> It attempts to merge the remaining records into a sibling page (left or right).</li>
<li class=""><strong>Cascading Reparenting:</strong> If a page is emptied and removed, the pointer in the <em>parent</em> node must be deleted. If this deletion causes the <em>parent</em> node to drop below its own threshold, the merge operation propagates upward. This &quot;rebalancing storm&quot; can ripple up to the root, causing massive I/O and locking overhead.</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="213-secondary-index-maintenance"><strong>2.1.3 Secondary Index Maintenance</strong><a href="#213-secondary-index-maintenance" class="hash-link" aria-label="Direct link to 213-secondary-index-maintenance" title="Direct link to 213-secondary-index-maintenance" translate="no">​</a></h4>
<p>Every secondary index in InnoDB stores the Primary Key as its pointer. If you delete a user with ID=100, Email=<a href="mailto:bob@test.com" target="_blank" rel="noopener noreferrer" class="">bob@test.com</a>, and Status=Active, InnoDB must:</p>
<ol>
<li class="">Delete 100 from the Clustered Index (B+ Tree).</li>
<li class="">Delete <a href="mailto:bob@test.com" target="_blank" rel="noopener noreferrer" class="">bob@test.com</a> from the Email Index (B+ Tree).</li>
<li class="">Delete Active from the Status Index (B+ Tree).<br>
<!-- -->Each of these requires random I/O operations. While the Change Buffer helps mitigate this for non-unique indexes by caching changes, unique indexes require immediate, synchronous disk operations to enforce constraints, amplifying the I/O cost significantly.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="22-postgresql"><strong>2.2 PostgreSQL</strong><a href="#22-postgresql" class="hash-link" aria-label="Direct link to 22-postgresql" title="Direct link to 22-postgresql" translate="no">​</a></h3>
<p>PostgreSQL handles deletion via Multi-Version Concurrency Control (MVCC). It does not remove data immediately; it versions it.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="221-the-invisible-update"><strong>2.2.1 The Invisible Update</strong><a href="#221-the-invisible-update" class="hash-link" aria-label="Direct link to 221-the-invisible-update" title="Direct link to 221-the-invisible-update" translate="no">​</a></h4>
<p>In PostgreSQL, an UPDATE is effectively a DELETE followed by an INSERT. A DELETE is simply an UPDATE that puts nothing back.</p>
<ul>
<li class=""><strong>xmin and xmax:</strong> Every tuple has an xmin (the transaction ID that created it) and an xmax (the transaction ID that deleted it).</li>
<li class=""><strong>Marking as Dead:</strong> When DELETE is run, Postgres finds the tuple and sets its xmax to the current transaction ID. The data remains physically on the disk.</li>
<li class=""><strong>Visibility Rules:</strong> Future transactions check the xmax. If xmax is set and committed, the tuple is invisible. To the storage engine, the page looks exactly the same as before, but the tuple is logically dead.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="222-the-vacuum-necessity"><strong>2.2.2 The Vacuum Necessity</strong><a href="#222-the-vacuum-necessity" class="hash-link" aria-label="Direct link to 222-the-vacuum-necessity" title="Direct link to 222-the-vacuum-necessity" translate="no">​</a></h4>
<p>Since DELETE does not free space, the table size does not decrease. It creates &quot;Dead Tuples.&quot; If these are not cleaned up, the table becomes &quot;bloated&quot;—a mixture of live data and digital corpses.</p>
<ul>
<li class=""><strong>Autovacuum:</strong> The autovacuum daemon runs in the background. It scans tables, looking for dead tuples that are older than any active transaction.</li>
<li class=""><strong>Freeing Space:</strong> It marks the line pointers as &quot;unused,&quot; allowing new inserts to overwrite the dead space. However, this process consumes CPU and I/O bandwidth and can block schema changes.</li>
</ul>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-the-performance-impact-of-hard-deletion">3. The Performance Impact of Hard Deletion<a href="#3-the-performance-impact-of-hard-deletion" class="hash-link" aria-label="Direct link to 3. The Performance Impact of Hard Deletion" title="Direct link to 3. The Performance Impact of Hard Deletion" translate="no">​</a></h2>
<p>The internal mechanics described above manifest as tangible performance degradation in production environments. The impact of hard deletes is rarely linear; it is exponential relative to the volume of data and concurrency of the system.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="31-the-locking-bottleneck"><strong>3.1 The Locking Bottleneck</strong><a href="#31-the-locking-bottleneck" class="hash-link" aria-label="Direct link to 31-the-locking-bottleneck" title="Direct link to 31-the-locking-bottleneck" translate="no">​</a></h3>
<p>Hard deletes are blocking operations.</p>
<ul>
<li class=""><strong>Gap Locks (MySQL):</strong> To preserve transaction isolation (specifically to prevent &quot;Phantom Reads&quot;), InnoDB places &quot;Gap Locks&quot; on the space <em>between</em> records. If you delete ID=10, InnoDB might lock the gap from ID=5 to ID=15. Any other transaction trying to insert ID=12 will be blocked until the delete commits. In high-concurrency systems, this leads to lock contention and &quot;Lock Wait Timeout Exceeded&quot; errors.</li>
<li class=""><strong>Exclusive Locks:</strong> Both engines take exclusive locks on the specific rows being deleted. If a reporting query is reading those rows, the delete will block (or vice versa), causing system stutter.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="32-io-thrashing-and-buffer-pool-pollution"><strong>3.2 I/O Thrashing and Buffer Pool Pollution</strong><a href="#32-io-thrashing-and-buffer-pool-pollution" class="hash-link" aria-label="Direct link to 32-io-thrashing-and-buffer-pool-pollution" title="Direct link to 32-io-thrashing-and-buffer-pool-pollution" translate="no">​</a></h3>
<p>Database performance relies heavily on caching &quot;hot&quot; pages in RAM (Buffer Pool).</p>
<ul>
<li class=""><strong>Random Access:</strong> Hard deletes are often random (e.g., deleting users who cancelled today). This forces the database to load widely scattered pages from the disk into memory just to mark a single bit.</li>
<li class=""><strong>Dirty Pages:</strong> Modifying a page marks it as &quot;dirty.&quot; Dirty pages must be flushed back to disk. A massive delete operation creates a flood of dirty pages, saturating the I/O subsystem and slowing down critical read operations.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="33-index-bloat-and-degradation"><strong>3.3 Index Bloat and Degradation</strong><a href="#33-index-bloat-and-degradation" class="hash-link" aria-label="Direct link to 33-index-bloat-and-degradation" title="Direct link to 33-index-bloat-and-degradation" translate="no">​</a></h3>
<ul>
<li class=""><strong>Postgres Index Bloat:</strong> In PostgreSQL, indexes contain pointers to heap tuples. When a tuple is updated or deleted, the index entry remains until Vacuum runs. If a table is heavily churned (high delete/update rate), the indexes can grow larger than the table itself. Larger indexes equate to slower searches, as they are less likely to fit in RAM.</li>
<li class=""><strong>MySQL Fragmentation:</strong> As described in Section 2.1.2, B+ Tree pages that are 50-60% full are inefficient. This fragmentation means that to read 1GB of actual data, the engine might need to read 2GB of disk pages, effectively halving the I/O throughput.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-the-architectural-solution-soft-deletion">4. The Architectural Solution: Soft Deletion<a href="#4-the-architectural-solution-soft-deletion" class="hash-link" aria-label="Direct link to 4. The Architectural Solution: Soft Deletion" title="Direct link to 4. The Architectural Solution: Soft Deletion" translate="no">​</a></h2>
<p>The &quot;Soft Delete&quot; pattern solves the physical storage problems by decoupling the <strong>business intent</strong> of deletion from the <strong>database mechanism</strong> of deletion. Instead of instructing the storage engine to perform a destructive structural change, the application performs a non-structural state change.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="41-implementation-patterns"><strong>4.1 Implementation Patterns</strong><a href="#41-implementation-patterns" class="hash-link" aria-label="Direct link to 41-implementation-patterns" title="Direct link to 41-implementation-patterns" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="411-the-boolean-flag"><strong>4.1.1 The Boolean Flag</strong><a href="#411-the-boolean-flag" class="hash-link" aria-label="Direct link to 411-the-boolean-flag" title="Direct link to 411-the-boolean-flag" translate="no">​</a></h4>
<p>The simplest implementation is a boolean column.</p>
<ul>
<li class=""><strong>Schema:</strong> is_deleted BOOLEAN DEFAULT FALSE</li>
<li class=""><strong>Logic:</strong> UPDATE table SET is_deleted = TRUE WHERE id = 1</li>
<li class=""><strong>Critique:</strong> While lightweight, this pattern lacks context. It tells you <em>that</em> a record was deleted, but not <em>when</em>.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="412-the-timestamp-recommended"><strong>4.1.2 The Timestamp (Recommended)</strong><a href="#412-the-timestamp-recommended" class="hash-link" aria-label="Direct link to 412-the-timestamp-recommended" title="Direct link to 412-the-timestamp-recommended" translate="no">​</a></h4>
<p>The industry standard pattern involves a nullable timestamp.</p>
<ul>
<li class=""><strong>Schema:</strong> deleted_at TIMESTAMP NULL</li>
<li class=""><strong>Logic:</strong> UPDATE table SET deleted_at = NOW() WHERE id = 1</li>
<li class=""><strong>Query:</strong> SELECT * FROM table WHERE deleted_at IS NULL</li>
<li class=""><strong>Benefit:</strong> This acts as a boolean flag (Null/NotNull) while simultaneously providing an audit trail of the deletion event.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="413-the-status-enum"><strong>4.1.3 The Status Enum</strong><a href="#413-the-status-enum" class="hash-link" aria-label="Direct link to 413-the-status-enum" title="Direct link to 413-the-status-enum" translate="no">​</a></h4>
<p>For complex state machines, deletion is just one of many states.</p>
<ul>
<li class=""><strong>Schema:</strong> status VARCHAR(20) CHECK (status IN (&#x27;active&#x27;, &#x27;pending&#x27;, &#x27;archived&#x27;, &#x27;deleted&#x27;))</li>
<li class=""><strong>Benefit:</strong> Useful when &quot;deletion&quot; is part of a workflow, such as a &quot;Recycle Bin&quot; that transitions to &quot;Permanently Deleted.&quot;</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="42-why-soft-deletes-resolve-storage-issues"><strong>4.2 Why Soft Deletes Resolve Storage Issues</strong><a href="#42-why-soft-deletes-resolve-storage-issues" class="hash-link" aria-label="Direct link to 42-why-soft-deletes-resolve-storage-issues" title="Direct link to 42-why-soft-deletes-resolve-storage-issues" translate="no">​</a></h3>
<ol>
<li class=""><strong>Zero Rebalancing:</strong> Updating a deleted_at timestamp is an in-place update. In MySQL, since the Primary Key is not changing, the row does not move. The B+ Tree structure remains perfectly balanced. No page merges occur.</li>
<li class=""><strong>Preserved Sequentiality:</strong> The data remains physically adjacent. Sequential read performance is preserved.</li>
<li class=""><strong>Reduced Locking:</strong> An update to a non-indexed column (like deleted_at) generally requires only a row lock, avoiding the aggressive Gap Locks associated with structural removal.</li>
</ol>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-business-use-cases-for-soft-deletion">5. Business Use Cases for Soft Deletion<a href="#5-business-use-cases-for-soft-deletion" class="hash-link" aria-label="Direct link to 5. Business Use Cases for Soft Deletion" title="Direct link to 5. Business Use Cases for Soft Deletion" translate="no">​</a></h2>
<p>Beyond performance optimization, Soft Deletion enables critical business capabilities that Hard Deletion inherently destroys.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="51-recoverability-the-undo-button"><strong>5.1 Recoverability: The &quot;Undo&quot; Button</strong><a href="#51-recoverability-the-undo-button" class="hash-link" aria-label="Direct link to 51-recoverability-the-undo-button" title="Direct link to 51-recoverability-the-undo-button" translate="no">​</a></h3>
<p>Human error is an inevitability in software systems.</p>
<ul>
<li class=""><strong>Unintended Deletes:</strong> Users frequently delete content accidentally on mobile devices. Soft deletes allow for an immediate &quot;Undo&quot; feature without complex backup restoration.</li>
<li class=""><strong>Production Safety:</strong> Engineering history is replete with stories of developers accidentally running DELETE without a WHERE clause. With soft deletes, this catastrophe is reversible via a simple SQL UPDATE statement (UPDATE table SET deleted_at = NULL). With hard deletes, this becomes a disaster recovery scenario requiring Point-in-Time Recovery (PITR), potentially costing hours of downtime and data loss.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="52-audit-and-compliance"><strong>5.2 Audit and Compliance</strong><a href="#52-audit-and-compliance" class="hash-link" aria-label="Direct link to 52-audit-and-compliance" title="Direct link to 52-audit-and-compliance" translate="no">​</a></h3>
<p>In regulated industries, data deletion is often a legal construct rather than a physical one.</p>
<ul>
<li class=""><strong>Traceability:</strong> A deleted_at column, often paired with deleted_by_user_id, provides an immutable audit trail. Organizations can answer inquiries such as &quot;Who cancelled this order?&quot; or &quot;When was this account terminated?&quot;.</li>
<li class=""><strong>Legal Obligations:</strong> Depending upon the business, some regulations might mandate data retention for 7-10 years. A user&#x27;s request to &quot;delete my account&quot; must be balanced against the legal requirement to &quot;retain transaction history.&quot; Soft deletion satisfies the user&#x27;s visibility requirement while satisfying the regulator&#x27;s retention requirement.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="53-referential-integrity-and-cascading"><strong>5.3 Referential Integrity and Cascading</strong><a href="#53-referential-integrity-and-cascading" class="hash-link" aria-label="Direct link to 53-referential-integrity-and-cascading" title="Direct link to 53-referential-integrity-and-cascading" translate="no">​</a></h3>
<p>Relational databases enforce integrity via Foreign Keys. You cannot delete a Parent if it has Children.</p>
<ul>
<li class=""><strong>Hard Delete Complexity:</strong> To hard delete a User, you must first delete their Orders, Invoices, Logs, and Comments. This triggers a massive &quot;Cascading Delete&quot; transaction that can touch dozens of tables and lock millions of rows.</li>
<li class=""><strong>Soft Delete Simplicity:</strong> You simply mark the User as deleted. The child records remain untouched (and referentially valid). The application layer is responsible for filtering out &quot;Orders belonging to deleted Users&quot; during display. This avoids the massive transactional overhead of cascading deletes.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-disadvantages-and-engineering-trade-offs">6. Disadvantages and Engineering Trade-offs<a href="#6-disadvantages-and-engineering-trade-offs" class="hash-link" aria-label="Direct link to 6. Disadvantages and Engineering Trade-offs" title="Direct link to 6. Disadvantages and Engineering Trade-offs" translate="no">​</a></h2>
<p>Soft deletion is an architectural compromise. It solves storage and recovery issues but introduces application-layer complexity.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="61-the-forgotten-where-clause"><strong>6.1 The &quot;Forgotten WHERE Clause&quot;</strong><a href="#61-the-forgotten-where-clause" class="hash-link" aria-label="Direct link to 61-the-forgotten-where-clause" title="Direct link to 61-the-forgotten-where-clause" translate="no">​</a></h3>
<p>The most pervasive risk is query correctness.</p>
<ul>
<li class=""><strong>The Leak:</strong> Every query in the application must now include AND deleted_at IS NULL. If a developer forgets this clause in a &quot;Total Revenue&quot; report, the report will incorrectly include refunded (deleted) orders.</li>
<li class=""><strong>Mitigation:</strong>
<ul>
<li class=""><strong>ORM Scopes:</strong> Use framework features (e.g., Hibernate @Where, Eloquent SoftDeletes) to automatically inject this clause.</li>
<li class=""><strong>Views:</strong> Create a database view active_users that filters the data, and restrict application access to the view rather than the raw table.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="62-index-bloat"><strong>6.2 Index Bloat</strong><a href="#62-index-bloat" class="hash-link" aria-label="Direct link to 62-index-bloat" title="Direct link to 62-index-bloat" translate="no">​</a></h3>
<p>Soft-deleted rows are still physically present. If a table contains 90% deleted data (e.g., a queue table), the indexes will be 90% &quot;junk.&quot; This reduces the effectiveness of the RAM cache, as valuable memory is wasted storing pointers to deleted data.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="7-the-lifecycle-strategy-batch-hard-deletion">7. The Lifecycle Strategy: Batch Hard Deletion<a href="#7-the-lifecycle-strategy-batch-hard-deletion" class="hash-link" aria-label="Direct link to 7. The Lifecycle Strategy: Batch Hard Deletion" title="Direct link to 7. The Lifecycle Strategy: Batch Hard Deletion" translate="no">​</a></h2>
<p>We have established that Hard Deletes are destructive, but Soft Deletes cause unlimited growth (bloat). The optimal architecture is a hybrid lifecycle: <strong>Soft Delete for Operations, Batch Hard Delete for Maintenance.</strong></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="71-the-nightly-batch-deletion-job"><strong>7.1 The &quot;Nightly&quot; Batch Deletion Job</strong><a href="#71-the-nightly-batch-deletion-job" class="hash-link" aria-label="Direct link to 71-the-nightly-batch-deletion-job" title="Direct link to 71-the-nightly-batch-deletion-job" translate="no">​</a></h3>
<p>The goal is to decouple the high-frequency user action (clicking delete) from the high-cost database operation (physical removal).</p>
<ol>
<li class=""><strong>User Action:</strong> Soft Delete. Instant, safe, recoverable.</li>
<li class=""><strong>Retention Policy:</strong> &quot;We keep deleted data for 30 days.&quot;</li>
<li class=""><strong>Background Process:</strong> A nightly job runs during off-peak hours (e.g., 3:00 AM) to physically purge records older than 30 days.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="72-why-batching-is-superior"><strong>7.2 Why Batching is Superior</strong><a href="#72-why-batching-is-superior" class="hash-link" aria-label="Direct link to 72-why-batching-is-superior" title="Direct link to 72-why-batching-is-superior" translate="no">​</a></h3>
<ul>
<li class=""><strong>Amortized I/O:</strong> Loading a page to delete 100 records is 100x more efficient than loading that page 100 separate times to delete 1 record at a time.</li>
<li class=""><strong>Sequential Access:</strong> Batch jobs can process deletions in Primary Key order, ensuring the disk head moves linearly.</li>
<li class=""><strong>Reduced Locking:</strong> The batch job can lock a small range, perform the delete, and release the lock, minimizing impact on active users.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="73-implementation-chunked-deletion"><strong>7.3 Implementation: Chunked Deletion</strong><a href="#73-implementation-chunked-deletion" class="hash-link" aria-label="Direct link to 73-implementation-chunked-deletion" title="Direct link to 73-implementation-chunked-deletion" translate="no">​</a></h3>
<p>Running DELETE FROM logs WHERE created_at &lt; &#x27;2023-01-01&#x27; is dangerous. It will attempt to lock millions of rows, potentially crashing the database. The correct approach is <strong>Chunking</strong>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="algorithm"><strong>Algorithm</strong><a href="#algorithm" class="hash-link" aria-label="Direct link to algorithm" title="Direct link to algorithm" translate="no">​</a></h4>
<ol>
<li class="">Identify the target rows.</li>
<li class="">Delete in small batches (e.g., 1000 rows).</li>
<li class="">Sleep/Throttle between batches to allow replication to catch up and CPU to cool down.</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="mysql-example-stored-procedure"><strong>MySQL Example (Stored Procedure)</strong><a href="#mysql-example-stored-procedure" class="hash-link" aria-label="Direct link to mysql-example-stored-procedure" title="Direct link to mysql-example-stored-procedure" translate="no">​</a></h4>
<p>MySQL allows LIMIT in DELETE statements, enabling simple chunking.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PROCEDURE</span><span class="token plain"> PurgeOldData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">BEGIN</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">REPEAT</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Delete 1000 rows, ordered by ID to maintain B-Tree locality  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> users   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> deleted\_at \</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DATE</span><span class="token plain">\_SUB</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">NOW</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> id   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- Sleep to prevent lock contention  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">DO</span><span class="token plain"> SLEEP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UNTIL </span><span class="token keyword" style="color:#00009f">ROW</span><span class="token plain">\_COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> \</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">END</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPEAT</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">END</span><span class="token plain">  </span><br></span></code></pre></div></div>
<p>Note: The ORDER BY id clause is critical. It ensures the deletion walks the B+ Tree leaves sequentially, preventing random I/O thrashing.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="postgresql-example-cte"><strong>PostgreSQL Example (CTE)</strong><a href="#postgresql-example-cte" class="hash-link" aria-label="Direct link to postgresql-example-cte" title="Direct link to postgresql-example-cte" translate="no">​</a></h4>
<p>PostgreSQL requires a Common Table Expression (CTE) to achieve similar chunking with lock skipping.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> rows_to_delete </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> ctid  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> users  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> deleted_at </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NOW</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;30 days&#x27;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UPDATE</span><span class="token plain"> SKIP LOCKED </span><span class="token comment" style="color:#999988;font-style:italic">-- Critical: Skip rows currently in use  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> users u  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">USING</span><span class="token plain"> rows_to_delete d  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> u</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctid</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Note: FOR UPDATE SKIP LOCKED allows the maintenance job to run concurrently with user activity without blocking.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="74-partition-pruning"><strong>7.4 Partition Pruning</strong><a href="#74-partition-pruning" class="hash-link" aria-label="Direct link to 74-partition-pruning" title="Direct link to 74-partition-pruning" translate="no">​</a></h3>
<p>For massive datasets (e.g., Audit Logs, Event Streams), even batch deletion is too slow. The architectural solution is <strong>Table Partitioning</strong>.</p>
<ul>
<li class=""><strong>Strategy:</strong> Partition the table by date (e.g., audit_2023_01, audit_2023_02).</li>
<li class=""><strong>Deletion:</strong> When January&#x27;s data expires, you do not run DELETE. You run DROP TABLE audit_2023_01.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="8-conclusion">8. Conclusion<a href="#8-conclusion" class="hash-link" aria-label="Direct link to 8. Conclusion" title="Direct link to 8. Conclusion" translate="no">​</a></h2>
<p>The decision to adopt Soft Deletes is not merely a preference for data retention; it is a fundamental alignment with the physics of database storage engines.</p>
<ul>
<li class=""><strong>Hard Deletes</strong> operate <em>against</em> the grain of the storage engine, forcing expensive rebalancing, causing fragmentation, and introducing dangerous locking contention in OLTP systems.</li>
<li class=""><strong>Soft Deletes</strong> operate <em>with</em> the grain, converting destructive structural changes into efficient state updates. They provide the safety net required for modern applications, enabling undo capabilities, audit trails, and simplified synchronization.</li>
</ul>
<p>By implementing Soft Deletes by design, combined with a disciplined Batch Hard Delete lifecycle, architects can build systems that remain performant, recoverable, and stable under scale.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/avoid-hard-deletes.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/blog/scaling-distributed-systems"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Scaling Distributed Systems (Focus on Databases)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/blog/cache-stampede-thundering-herd"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">The Thundering Herd - Understanding and Solving the Cache Stampede</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#1-storage-engine-internals" class="table-of-contents__link toc-highlight">1. Storage Engine Internals</a><ul><li><a href="#11-mysql-innodb-the-index-organized-table" class="table-of-contents__link toc-highlight"><strong>1.1 MySQL InnoDB: The Index-Organized Table</strong></a></li><li><a href="#12-postgresql-the-heap-and-tuple-architecture" class="table-of-contents__link toc-highlight"><strong>1.2 PostgreSQL: The Heap and Tuple Architecture</strong></a></li></ul></li><li><a href="#2-the-pain-caused-by-hard-deletion" class="table-of-contents__link toc-highlight">2. The pain caused by Hard Deletion</a><ul><li><a href="#21-mysql-innodb-the-rebalancing-storm" class="table-of-contents__link toc-highlight"><strong>2.1 MySQL InnoDB: The Rebalancing Storm</strong></a></li><li><a href="#22-postgresql" class="table-of-contents__link toc-highlight"><strong>2.2 PostgreSQL</strong></a></li></ul></li><li><a href="#3-the-performance-impact-of-hard-deletion" class="table-of-contents__link toc-highlight">3. The Performance Impact of Hard Deletion</a><ul><li><a href="#31-the-locking-bottleneck" class="table-of-contents__link toc-highlight"><strong>3.1 The Locking Bottleneck</strong></a></li><li><a href="#32-io-thrashing-and-buffer-pool-pollution" class="table-of-contents__link toc-highlight"><strong>3.2 I/O Thrashing and Buffer Pool Pollution</strong></a></li><li><a href="#33-index-bloat-and-degradation" class="table-of-contents__link toc-highlight"><strong>3.3 Index Bloat and Degradation</strong></a></li></ul></li><li><a href="#4-the-architectural-solution-soft-deletion" class="table-of-contents__link toc-highlight">4. The Architectural Solution: Soft Deletion</a><ul><li><a href="#41-implementation-patterns" class="table-of-contents__link toc-highlight"><strong>4.1 Implementation Patterns</strong></a></li><li><a href="#42-why-soft-deletes-resolve-storage-issues" class="table-of-contents__link toc-highlight"><strong>4.2 Why Soft Deletes Resolve Storage Issues</strong></a></li></ul></li><li><a href="#5-business-use-cases-for-soft-deletion" class="table-of-contents__link toc-highlight">5. Business Use Cases for Soft Deletion</a><ul><li><a href="#51-recoverability-the-undo-button" class="table-of-contents__link toc-highlight"><strong>5.1 Recoverability: The &quot;Undo&quot; Button</strong></a></li><li><a href="#52-audit-and-compliance" class="table-of-contents__link toc-highlight"><strong>5.2 Audit and Compliance</strong></a></li><li><a href="#53-referential-integrity-and-cascading" class="table-of-contents__link toc-highlight"><strong>5.3 Referential Integrity and Cascading</strong></a></li></ul></li><li><a href="#6-disadvantages-and-engineering-trade-offs" class="table-of-contents__link toc-highlight">6. Disadvantages and Engineering Trade-offs</a><ul><li><a href="#61-the-forgotten-where-clause" class="table-of-contents__link toc-highlight"><strong>6.1 The &quot;Forgotten WHERE Clause&quot;</strong></a></li><li><a href="#62-index-bloat" class="table-of-contents__link toc-highlight"><strong>6.2 Index Bloat</strong></a></li></ul></li><li><a href="#7-the-lifecycle-strategy-batch-hard-deletion" class="table-of-contents__link toc-highlight">7. The Lifecycle Strategy: Batch Hard Deletion</a><ul><li><a href="#71-the-nightly-batch-deletion-job" class="table-of-contents__link toc-highlight"><strong>7.1 The &quot;Nightly&quot; Batch Deletion Job</strong></a></li><li><a href="#72-why-batching-is-superior" class="table-of-contents__link toc-highlight"><strong>7.2 Why Batching is Superior</strong></a></li><li><a href="#73-implementation-chunked-deletion" class="table-of-contents__link toc-highlight"><strong>7.3 Implementation: Chunked Deletion</strong></a></li><li><a href="#74-partition-pruning" class="table-of-contents__link toc-highlight"><strong>7.4 Partition Pruning</strong></a></li></ul></li><li><a href="#8-conclusion" class="table-of-contents__link toc-highlight">8. Conclusion</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"></div></footer></div>
</body>
</html>